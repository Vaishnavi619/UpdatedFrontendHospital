
<div class="container py-4">
  <h2 class="text-primary mb-3">Doctor Availability</h2>
  <p class="text-muted mb-4">Doctor ID: {{ doctorId }}</p>

  <!-- Add availability -->
  <div class="card p-3 mb-4">
    <h5 class="mb-3">Add Weekly Slot</h5>

    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Day</label>
        <select class="form-select" [(ngModel)]="newAvailability.dayOfWeek" name="dayOfWeek">
          <option value="" disabled selected>Select Day</option>
          <option *ngFor="let d of days" [value]="d">{{ d }}</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Start Time</label>
        <input type="time" class="form-control" [(ngModel)]="newAvailability.startTime" name="startTime" />
      </div>

      <div class="col-md-3">
        <label class="form-label">End Time</label>
        <input type="time" class="form-control" [(ngModel)]="newAvailability.endTime" name="endTime" />
      </div>

      <div class="col-md-2">
        <button class="btn btn-primary w-100" (click)="addAvailability()">Add</button>
      </div>
    </div>
  </div>

  <!-- Existing rows -->
  <div class="card p-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="m-0">Existing Availability</h5>
      <span *ngIf="loading" class="text-secondary">Loadingâ€¦</span>
    </div>

    <div *ngIf="availabilities.length === 0 && !loading" class="alert alert-info mb-0">
      No availability added yet. Use the form above to add the first slot.
    </div>

    <div class="table-responsive" *ngIf="availabilities.length > 0">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th style="width: 20%">Day</th>
            <th style="width: 25%">Start</th>
            <th style="width: 25%">End</th>
            <th style="width: 30%">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of availabilities">
            <!-- Day -->
            <td *ngIf="editingId !== row.doctorAvailibilityId">{{ row.dayOfWeek }}</td>
            <td *ngIf="editingId === row.doctorAvailibilityId">
              <select class="form-select" [(ngModel)]="editRow!.dayOfWeek">
                <option *ngFor="let d of days" [value]="d">{{ d }}</option>
              </select>
            </td>

            <!-- Start -->
            <td *ngIf="editingId !== row.doctorAvailibilityId">{{ row.startTime }}</td>
            <td *ngIf="editingId === row.doctorAvailibilityId">
              <input type="time" class="form-control" [(ngModel)]="editRow!.startTime" />
            </td>

            <!-- End -->
            <td *ngIf="editingId !== row.doctorAvailibilityId">{{ row.endTime }}</td>
            <td *ngIf="editingId === row.doctorAvailibilityId">
              <input type="time" class="form-control" [(ngModel)]="editRow!.endTime" />
            </td>

            <!-- Actions -->
            <td>
              <ng-container *ngIf="editingId !== row.doctorAvailibilityId; else editing">
                <button class="btn btn-outline-primary btn-sm me-2" (click)="beginEdit(row)">Edit</button>
                <button class="btn btn-outline-danger btn-sm" (click)="deleteAvailability(row)">Delete</button>
              </ng-container>

              <ng-template #editing>
                <button class="btn btn-primary btn-sm me-2" (click)="saveEdit(row)">Save</button>
                <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Cancel</button>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
